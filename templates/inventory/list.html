{% extends 'base.html' %}

{% block page_title %}Fuel Inventory Management{% endblock %}
{% block page_description %}Monitor and manage fuel stock levels across stations.{% endblock %}

{% block content %}

<div class="space-y-6">
    {% for inventory in inventory_list %}
    {% with station=inventory.station_id %}
    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 flex items-start justify-between">
        
        {# --- Inventory Details --- #}
        <div>
            <div class="flex items-center mb-2">
                <span class="w-8 h-8 rounded-full flex items-center justify-center mr-3 
                    {% if inventory.fuel_type == 'Petrol' %}bg-petrol/10 text-petrol{% else %}bg-diesel/10 text-diesel{% endif %}">
                    {# Simple drop icon for fuel type #}
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                        <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm.53 5.47a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72v5.19a.75.75 0 0 0 1.5 0V8.06l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z" clip-rule="evenodd" />
                    </svg>
                </span>
                <h3 class="text-xl font-bold text-gray-900">{{ inventory.fuel_type }}</h3>
            </div>
            
            <p class="text-sm text-gray-500 mb-4">
                <span class="font-semibold text-gray-700">{{ station.name }}</span> ({{ station.location }})
            </p>

            <div class="grid grid-cols-2 gap-4 text-sm">
                {# Row 1: Current Level #}
                <div>
                    <p class="text-xs font-medium text-gray-500 uppercase">Current Level</p>
                    <p class="text-lg font-semibold text-gray-800">{{ inventory.quantity|floatformat:0 }} / {{ inventory.capacity|floatformat:0 }} L</p>
                </div>

                {# Row 2: Price #}
                <div>
                    <p class="text-xs font-medium text-gray-500 uppercase">Price per Liter</p>
                    <p class="text-lg font-semibold text-gray-800">{{ inventory.unit_price|floatformat:2 }} RWF</p>
                </div>
                
              {# Row 3: Progress Bar & Status #}
                <div class="col-span-2">
                    {% with percentage=inventory.percentage|floatformat:0 %}
                    <div class="w-full bg-gray-200 rounded-full h-2.5 mb-1.5">
                        {% if percentage >= 25 %}
                            {% if inventory.fuel_type == 'Petrol' %}
                        <div class="h-2.5 rounded-full bg-petrol progress-bar" data-width="{{ percentage }}"></div>
                            {% else %}
                        <div class="h-2.5 rounded-full bg-diesel progress-bar" data-width="{{ percentage }}"></div>
                            {% endif %}
                        {% else %}
                        <div class="h-2.5 rounded-full bg-red-500 progress-bar" data-width="{{ percentage }}"></div>
                        {% endif %}
                    </div>
                    <p class="text-xs font-semibold 
                        {% if percentage >= 25 %}
                            {% if inventory.fuel_type == 'Petrol' %}text-petrol{% else %}text-diesel{% endif %}
                        {% else %}
                            text-red-500
                        {% endif %}">
                        {{ percentage }}% - 
                        {% if percentage >= 25 %}Good{% else %}Low Stock Alert!{% endif %}
                    </p>
                    {% endwith %}
                </div>
                {# Row 4: Minimum Threshold #}
                <div class="col-span-2 mt-2">
                    <p class="text-xs font-medium text-gray-500 uppercase">Min Threshold</p>
                    <p class="text-base text-gray-600">{{ inventory.min_threshold|floatformat:0 }} L</p>
                </div>
            </div>
        </div>

        {# --- Action Button (Conditional) --- #}
        {% if can_edit %}
         <div class="flex-shrink-0">
             <a href="{% url 'inventory_update' inventory_id=inventory.inventory_id %}" class="inline-flex items-center p-2 text-sm font-medium rounded-full bg-brand-blue/10 text-brand-blue hover:bg-brand-blue hover:text-white transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 18.07a4.99 4.99 0 0 1-1.285.385l-1.928.64a.5.5 0 0 1-.6.6l.64-1.928a4.99 4.99 0 0 1 .385-1.285L16.862 4.487Z" />
                 </svg>
             </a>
         </div>
      {% endif %}

    </div>
    {% endwith %}
    {% empty %}
    <div class="p-6 text-center text-gray-500 bg-white rounded-xl shadow-md">
        <p>No inventory records found for your assigned stations/companies.</p>
        {% if user_role == 'Admin' %}
            <p class="mt-2 text-sm">As an Admin, you should see all inventory. Check that inventory records exist in the database.</p>
        {% endif %}
    </div>
    {% endfor %}
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Set progress bar widths from data attributes
    document.querySelectorAll('.progress-bar').forEach(bar => {
        const width = bar.getAttribute('data-width');
        bar.style.width = width + '%';
    });
</script>
{% endblock %}